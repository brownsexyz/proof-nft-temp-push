# .github/workflows/unzip.yml
name: Unpack monorepo ZIP

on:
  workflow_dispatch:       # run it manually from the â€œActionsâ€ tab

permissions:               # <-- give the workflow permission to push
  contents: write          #   (default is read-only!)

jobs:
  unzip:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥  Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0    # keep history so push works

      - name: ğŸ“¦  Unzip all root-level ZIPs
        run: |
          set -e
          shopt -s nullglob
          for z in *.zip; do
            echo "â–¶ï¸  Unpacking $z"
            unzip -o "$z" -d .
            git rm "$z"
          done

      - name: ğŸ“  Commit unpacked source
        run: |
          git config user.name  "unzip-bot"
          git config user.email "unzip-bot@users.noreply.github.com"
          git add .
          git commit -m "Unpack monorepo archive ğŸš€" || echo "Nothing to commit"
          git push origin HEAD
